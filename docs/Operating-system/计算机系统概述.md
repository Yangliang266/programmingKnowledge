## 计算机的主要结构组件

### 1 中央处理器

> 负责解析并执行系统指令，进行计算机数据的处理，与内存交换数据

#### 1.1 指令的执行

##### 1.1.1 处理器执行指令的操作包含 

1. 处理器-内存

   > 数据从处理器到内存，或者从内存到处理器

2. 处理器-io模块

   > 通过处理器和io模块之间数据的传递，将数据传出到外部设备，或者从外部设备传入到处理器

3. 数据处理

   > 处理器执行数据的逻辑或者算术操作

4. 控制

   > 某些指令可以是指令的执行顺序发生变化



##### 1.1.2 取指阶段

##### 1.1.3 执行阶段

这两个阶段可以通过内存指令的相加流程来表示

<img src="https://yliang.oss-cn-shanghai.aliyuncs.com/img/programming/frame/mybatis/%E6%8C%87%E4%BB%A4%E7%9A%84%E5%8F%96%E6%8C%87%E4%B8%8E%E6%89%A7%E8%A1%8C.png" alt="指令的取指与执行" style="zoom: 67%;" />

#### 1.2 指令的中断

##### 1.2.1 中断的类型 

1. 程序中断

   > 某些条件产成立，由指令的结果产生。如试图执行非法指令

2. 时钟中断

   > 处理器内部计时器触发（晶振片），运行操作系统有规律的执行某些操作

3. io中断

   > io控制器产生，通知已完成某些操作或者产生某种错误

4. 硬件中断

   > 电源故障



##### 1.2.2  I/O例程 

1. IO的初始化
2. 执行io操作
3. 结束io操作



##### 1.2.3 中断处理

1. 处理器收到中断信号
2. 处理器中断当前程序
3. 处理器检查是否存在中断
4. 将当前的程序信息，寄存器以及程序计数器（存储中断程序的入口地址，每类中断都对应一个中断程序）保存到系统堆栈中
5. 运行中断程序（io应答或者其他事件）
6. 从堆栈中恢复寄存器
7. 恢复状态字psw和程序计数器的值，便于执行中断处下一个指令

<img src="https://yliang.oss-cn-shanghai.aliyuncs.com/img/programming/frame/mybatis/%E6%8C%87%E4%BB%A4%E7%9A%84%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86.png" alt="指令的中断处理" style="zoom:67%;" />

#### 1.3 多个指令中断

##### 1.3.1 中断策略

1. 顺序中断

   > 带来的问题，如果当前中断的条件依附于其他中断（比如先要控制磁盘空间，然后进行io读取），顺序不一致，系统混乱

2. 嵌套中断

   > 在某个中断嵌套另一个优先级高于当前的中断，即先执行嵌套中的中断，在执行外部的中断



#### 1.4 指令执行的具体流程

<img src="https://yliang.oss-cn-shanghai.aliyuncs.com/img/programming/frame/mybatis/%E6%8C%87%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B.png" alt="指令执行流程" style="zoom:80%;" />

#### 1.5 直接内存访问 

##### 可编程io

> io模块执行请求动作，不会中断cpu，cpu不断的监控io状态，确定操作是否完成

##### 中断驱动io

> cpu向io模块发出io指令，cpu会执行其他的指令，待到io设备执行完毕，cpu会中断当前处理器的执行，继续执行原来的指令

##### 直接内存访问

> cpu发出io指令，交给AMD模块执行，不需要额外的cpu干预



#### 1.6 多处理器和多核处理器

> 多处理器可以看作时多个cpu单元，每个单元有独立的缓存，每一个线程在一个独立的CPU上，线程间的所有协作都要走总线

> 多核处理器表示一个cpu单元内有多个核心（包括alu，缓存，控制单元）一套芯片组，一套存储，多核之间通过芯片内部总线进行通信，共享使用内存，可以看作是分片的思想，逻辑计算的分片，存储的分片。



### 2 存储器

#### 2.1 内部存储器（片上存储）

> 寄存器，高速缓存，内存

##### 2.1.1 内存（RAM）

###### 组成

> 由2^n^个可寻地址的字组成，每个字有一个唯一的n位地址，若干个字组成一个块，每个块中有k个字，内存块数等于2^n^/k

###### 特点

> 易失性,即计算机断电后数据也会被移除

###### 作用

> 存储数据和程序

##### 2.1.2 高速缓存

###### 高速缓存存在的意义

> 由于cpu的执行指令的速率受限于存储器周期（从存储器读一个字到或者写一个字到存储器的时间），cpu的运行速度和到内存访问速度极不匹配

###### 高速缓存的原理

高速缓存由c个槽组成，每个槽包含k个字，对应到内存中的块，槽的数量明显少于主存



###### 高速缓存的级别

> L1 -> L2 -> L3
>
> 容量递增
>
> 速度递减

###### 高速缓存设计的思考

1. 为什么高速缓存的容量小

   > 如果将缓存的容量增大，不仅仅是成本和功耗上得不偿失，也将会让缓存的查找效率降低而使缓存丧失意义。

2. 槽/块的大小是不是越大越好

   > 当前数据被频繁访问时，附近的数据被加载到高速缓存，根据局部性特性（当数据被频繁访问时，那么这个数据附近的数据被命中的几率会大大提高），如果块的容量太大，则被命中的几率大大下降

3. 为什么要设置级数

   > 虽然各个级别的高速缓存的存储周期的速率不一样，缓存与缓存之间的差异不是很大，如果不设置级别，那么cpu与高速缓存的速率差异将大于设置级别的高速缓存

4. 置换算法

   > 当高速缓存溢出时，将使用何种算法，将数据块移除，最近最少使用LRU算法

5. 映射函数

   > 将数据块映射到哪个槽

6. 写策略

   > 当高速缓存的数据发生变更时，如何将数据写回内存
   >
   > 1 发生变更时，写回
   >
   > 2 当数据块被替换时，写回

##### 2.1.3 寄存器

> 寄存器在cpu可以分为地址寄存器，缓冲寄存器
>
> 地址寄存器 -> 内存地址寄存器，io地址寄存器
>
> 缓冲寄存器 -> 内存缓冲寄存器，io缓冲寄存器

> 寄存器存放从高速缓存读取的指令，供cpu执行

##### 2.1.4 只读存储(ROM)

> 只读存储器的特点是只能读出而不能写入信息，通常在电脑主板的ROM里面固化一个基本输入/输出系统，称为[BIOS](https://baike.baidu.com/item/BIOS/91424)（基本输入输出系统）。其主要作用是完成对系统的加电自检、系统中各功能模块的初始化、系统的基本输入/输出的驱动程序及引导操作系统。



#### 2.2 外部存储器（片外存储）

> 磁盘，cd-rom/dvd-ram

### 3 IO模块

> 在计算机和外部环境之间交换数据（比如磁盘，网卡，cd）

### 4 系统总线

> 负责处理器，内存，io模块之间的通信









