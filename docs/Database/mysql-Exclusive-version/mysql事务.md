#### 事务的特性

1. 原子性

   > 强调事务的不可分割

2. 一致性

   > 事务的执行的前后数据的完整性保持一致.

3. 隔离性

   > 一个事务执行的过程中,不应该受到其他事务的干扰

4. 持久性

   > 事务一旦结束,数据就持久到数据库

[持久](https://baike.baidu.com/item/持久)化（Persistence），即把数据（如内存中的对象）保存到可永久保存的存储设备中（如磁盘）。持久化的主要应用是将内存中的对象存储在数据库中，或者存储在磁盘文件中、XML数据文件中等等。

持久化是将程序数据在[持久](https://baike.baidu.com/item/持久)状态和瞬时状态间转换的机制。通俗的讲，就是瞬时数据（比如内存中的数据，是不能永久保存的）持久化为持久数据（比如持久化至数据库中，能够长久保存）。



#### 事务开启与结束

开启事务

手动/自动

结束事务

手动commit/rollback  释放 



##### 事务并发

**如果不考虑隔离性引发安全性问题:**

| 脏读         | 一个事务读到了另一个事务的未提交的数据                       |
| ------------ | ------------------------------------------------------------ |
| 不可重复读 : | 一个事务读到了另一个事务已经提交的 update 的数据导致多次查询结果不一致. |
| 虚幻读       | 一个事务读到了另一个事务已经提交的 insert 的数据导致多次查询结果不一致. |

##### 解决读问题:设置事务隔离级别

| 未提交读已提交读可重复读串行化的 | 脏读，不可重复读，虚读都有可能发生避免脏读。但是不可重复读和虚读有可能发生避免脏读和不可重复读.但是虚读有可能发生.避免以上所有读问题.cv |
| -------------------------------- | ------------------------------------------------------------ |
|                                  |                                                              |

Mysql 默认:可重复读

Oracle 默认:读已提交

##### 解决方法

**1 mvcc 快照**

![img](https://raw.githubusercontent.com/YangLiang-SoftWise/images/master/img/索引10.png)

**2lbcc 加锁：事务对并数据并发访问问题的解决**

共享锁 ： 多个事务对于同一数据共享只读不写

排他锁： 写锁不能与其他锁共存

意向排他锁 ：一行数据在排他锁之前加上意向排他锁

意向共享锁： 一行数据在排他锁之前加上意向共享锁

记录锁：唯一索引，精准查询

间隙锁：查不到记录存在，上锁

临键锁：包含记录和区间，由于遵循左开右闭，所以会锁住下一个区间

![img](https://raw.githubusercontent.com/YangLiang-SoftWise/images/master/img/索引9.png)

innoDB : 行锁默认是临键锁

其退化模式是

无记录 - 记录锁

只查一个记录 - 间隙锁